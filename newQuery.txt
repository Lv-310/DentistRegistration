USE LV_310_DENTISTRY;

GO

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES 
           WHERE TABLE_NAME = 'CALENDAR_EVENT_RULE')
BEGIN
	CREATE TABLE CALENDAR_EVENT_RULE(RULE_ID INT IDENTITY(1,1) NOT NULL,
	ISINCLUDE BIT NOT NULL,
	STARTDATE DATETIME NOT NULL,
	TIMETOFINISH BIGINT NOT NULL,
	EVENTDURATION BIGINT NOT NULL,
	REPEATINTERVAL BIGINT NOT NULL,
	DATEEXPIRE DATETIME NOT NULL,
	CONSTRAINT PK_RULES PRIMARY KEY (RULE_ID))
END;

GO

IF object_id('spDeleteEventRule') IS NULL
    EXEC ('create procedure dbo.spDeleteEventRule as select 1')
GO
ALTER PROCEDURE spDeleteEventRule
@RULE_ID INT
AS
BEGIN
DELETE FROM CALENDAR_EVENT_RULE
WHERE RULE_ID=@RULE_ID
END;

GO

IF object_id('spUpdateEventRule') IS NULL
    EXEC ('create procedure dbo.spUpdateEventRule as select 1')
GO
ALTER PROCEDURE spUpdateEventRule
@RULE_ID INT, @ISINCLUDE BIT, @STARTDATE DATETIME, @TIMETOFINISH BIGINT, @EVENTDURATION BIGINT, @REPEATINTERVAL BIGINT, @DATEEXPIRE DATETIME
AS
BEGIN
UPDATE CALENDAR_EVENT_RULE
SET 
ISINCLUDE = @ISINCLUDE,
STARTDATE = @STARTDATE,
TIMETOFINISH = @TIMETOFINISH,
EVENTDURATION = @EVENTDURATION,
REPEATINTERVAL = @REPEATINTERVAL,
DATEEXPIRE = @DATEEXPIRE
WHERE RULE_ID = @RULE_ID
END;
